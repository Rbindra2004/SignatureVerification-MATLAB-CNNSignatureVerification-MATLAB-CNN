<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      -->
<title>untitled2</title>
<meta name="generator" content="MATLAB 23.2">
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
<meta name="DC.date" content="2025-04-25">
<meta name="DC.source" content="untitled2.m">
<style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style>
</head>
<body>
<div class="content">
<h1></h1>
<!--introduction-->
<!--/introduction-->
<h2>Contents</h2>
<div>
<ul>
<li>
<a href="#1">loading dataset</a>
</li>
<li>
<a href="#2">shuffling data</a>
</li>
<li>
<a href="#3">train-test split</a>
</li>
<li>
<a href="#4">data augmentation for training</a>
</li>
<li>
<a href="#5">network structure (with 4 conv layers + flattening)</a>
</li>
<li>
<a href="#6">training options</a>
</li>
<li>
<a href="#7">training</a>
</li>
<li>
<a href="#8">evaluation</a>
</li>
<li>
<a href="#9">Saving the model</a>
</li>
</ul>
</div>
<h2 id="1">loading dataset</h2>
<pre class="codeinput">folders = {<span class="string">'dataset1'</span>, <span class="string">'dataset2'</span>, <span class="string">'dataset3'</span>, <span class="string">'dataset4'</span>};
imds = imageDatastore(folders, <span class="string">"IncludeSubfolders"</span>, true, <span class="string">"LabelSource"</span>, <span class="string">"foldernames"</span>);
label_set = countEachLabel(imds);
img = readimage(imds,1);
disp(size(img));  <span class="comment">% Just to check original size</span>
</pre>
<pre class="codeoutput">    83   226     3

</pre>
<h2 id="2">shuffling data</h2>
<pre class="codeinput">imdsrand = shuffle(imds);
</pre>
<h2 id="3">train-test split</h2>
<pre class="codeinput">[imdsTrain, imdsValidation] = splitEachLabel(imdsrand, 0.8, <span class="string">'randomized'</span>);
</pre>
<h2 id="4">data augmentation for training</h2>
<pre class="codeinput">augmenter = imageDataAugmenter( <span class="keyword">...</span>
    <span class="string">'RandRotation'</span>, [-10,10], <span class="keyword">...</span>
    <span class="string">'RandXTranslation'</span>, [-10 10], <span class="keyword">...</span>
    <span class="string">'RandYTranslation'</span>, [-10 10], <span class="keyword">...</span>
    <span class="string">'RandXScale'</span>, [0.9 1.1], <span class="keyword">...</span>
    <span class="string">'RandYScale'</span>, [0.9 1.1]);

augTrainDs = augmentedImageDatastore([83 226 3], imdsTrain, <span class="keyword">...</span>
    <span class="string">'DataAugmentation'</span>, augmenter, <span class="keyword">...</span>
    <span class="string">'ColorPreprocessing'</span>, <span class="string">'gray2rgb'</span>);

augValDs = augmentedImageDatastore([83 226 3], imdsValidation, <span class="keyword">...</span>
    <span class="string">'ColorPreprocessing'</span>, <span class="string">'gray2rgb'</span>);
</pre>
<h2 id="5">network structure (with 4 conv layers + flattening)</h2>
<pre class="codeinput">layers = [
    imageInputLayer([83 226 3])

    convolution2dLayer(3, 16, <span class="string">'Padding'</span>, <span class="string">'same'</span>)
    batchNormalizationLayer
    reluLayer
    maxPooling2dLayer(2, <span class="string">'Stride'</span>, 2)

    convolution2dLayer(3, 32, <span class="string">'Padding'</span>, <span class="string">'same'</span>)
    batchNormalizationLayer
    reluLayer
    maxPooling2dLayer(2, <span class="string">'Stride'</span>, 2)

    convolution2dLayer(3, 64, <span class="string">'Padding'</span>, <span class="string">'same'</span>)
    batchNormalizationLayer
    reluLayer
    maxPooling2dLayer(2, <span class="string">'Stride'</span>, 2)

    convolution2dLayer(3, 128, <span class="string">'Padding'</span>, <span class="string">'same'</span>)
    batchNormalizationLayer
    reluLayer
    maxPooling2dLayer(2, <span class="string">'Stride'</span>, 2)

    flattenLayer

    fullyConnectedLayer(2)  <span class="comment">% Binary classification</span>
    softmaxLayer
    classificationLayer
];
</pre>
<h2 id="6">training options</h2>
<pre class="codeinput">options = trainingOptions(<span class="string">'adam'</span>, <span class="keyword">...</span>
    <span class="string">'MaxEpochs'</span>, 15, <span class="keyword">...</span>
    <span class="string">'MiniBatchSize'</span>, 16, <span class="keyword">...</span>
    <span class="string">'Shuffle'</span>, <span class="string">'every-epoch'</span>, <span class="keyword">...</span>
    <span class="string">'ValidationData'</span>, augValDs, <span class="keyword">...</span>
    <span class="string">'ValidationFrequency'</span>, 20, <span class="keyword">...</span>
    <span class="string">'Verbose'</span>, true, <span class="keyword">...</span>
    <span class="string">'Plots'</span>, <span class="string">'training-progress'</span>);
</pre>
<h2 id="7">training</h2>
<pre class="codeinput">net = trainNetwork(augTrainDs, layers, options);
</pre>
<pre class="codeoutput">Training on single CPU.
Initializing input data normalization.
|======================================================================================================================|
|  Epoch  |  Iteration  |  Time Elapsed  |  Mini-batch  |  Validation  |  Mini-batch  |  Validation  |  Base Learning  |
|         |             |   (hh:mm:ss)   |   Accuracy   |   Accuracy   |     Loss     |     Loss     |      Rate       |
|======================================================================================================================|
|       1 |           1 |       00:00:06 |       37.50% |       50.00% |       2.1944 |       6.2027 |          0.0010 |
|       1 |          20 |       00:00:20 |       43.75% |       50.00% |       1.2575 |       2.7064 |          0.0010 |
|       2 |          40 |       00:00:32 |       50.00% |       53.47% |       0.9656 |       1.2967 |          0.0010 |
|       2 |          50 |       00:00:37 |       50.00% |              |       1.1715 |              |          0.0010 |
|       2 |          60 |       00:00:44 |       68.75% |       63.19% |       0.8477 |       0.7175 |          0.0010 |
|       3 |          80 |       00:00:57 |       68.75% |       55.56% |       1.0658 |       0.9427 |          0.0010 |
|       3 |         100 |       00:01:09 |       68.75% |       71.53% |       0.4690 |       0.6696 |          0.0010 |
|       4 |         120 |       00:01:21 |       62.50% |       64.58% |       0.5589 |       0.6940 |          0.0010 |
|       4 |         140 |       00:01:32 |       81.25% |       70.14% |       0.3265 |       0.6234 |          0.0010 |
|       5 |         150 |       00:01:36 |       62.50% |              |       0.5198 |              |          0.0010 |
|       5 |         160 |       00:01:42 |       50.00% |       61.81% |       1.0062 |       0.6980 |          0.0010 |
|       5 |         180 |       00:01:53 |       68.75% |       66.67% |       0.4214 |       0.6897 |          0.0010 |
|       6 |         200 |       00:02:04 |       56.25% |       59.72% |       0.8910 |       0.8250 |          0.0010 |
|       7 |         220 |       00:02:15 |       87.50% |       79.17% |       0.2820 |       0.5118 |          0.0010 |
|       7 |         240 |       00:02:26 |       56.25% |       70.14% |       1.5345 |       0.6349 |          0.0010 |
|       7 |         250 |       00:02:31 |       75.00% |              |       0.4683 |              |          0.0010 |
|       8 |         260 |       00:02:38 |       56.25% |       75.00% |       0.8741 |       0.5009 |          0.0010 |
|       8 |         280 |       00:02:48 |      100.00% |       79.17% |       0.1833 |       0.4796 |          0.0010 |
|       9 |         300 |       00:02:58 |       93.75% |       78.47% |       0.2368 |       0.4199 |          0.0010 |
|       9 |         320 |       00:03:10 |       75.00% |       75.69% |       0.4026 |       0.4525 |          0.0010 |
|      10 |         340 |       00:03:20 |       93.75% |       79.86% |       0.1675 |       0.4410 |          0.0010 |
|      10 |         350 |       00:03:25 |       87.50% |              |       0.2444 |              |          0.0010 |
|      10 |         360 |       00:03:31 |       62.50% |       79.17% |       0.6272 |       0.4197 |          0.0010 |
|      11 |         380 |       00:03:43 |       68.75% |       83.33% |       0.6847 |       0.3462 |          0.0010 |
|      12 |         400 |       00:03:53 |       81.25% |       75.00% |       0.3592 |       0.5172 |          0.0010 |
|      12 |         420 |       00:04:04 |       87.50% |       85.42% |       0.2388 |       0.4731 |          0.0010 |
|      13 |         440 |       00:04:14 |       81.25% |       82.64% |       0.3476 |       0.3454 |          0.0010 |
|      13 |         450 |       00:04:19 |       87.50% |              |       0.2837 |              |          0.0010 |
|      13 |         460 |       00:04:25 |       93.75% |       74.31% |       0.2197 |       0.5962 |          0.0010 |
|      14 |         480 |       00:04:36 |       93.75% |       79.86% |       0.1433 |       0.4602 |          0.0010 |
|      14 |         500 |       00:04:47 |       93.75% |       83.33% |       0.2215 |       0.3457 |          0.0010 |
|      15 |         520 |       00:04:58 |       81.25% |       76.39% |       0.3883 |       0.4449 |          0.0010 |
|      15 |         540 |       00:05:08 |       81.25% |       85.42% |       0.2569 |       0.3382 |          0.0010 |
|======================================================================================================================|
Training finished: Max epochs completed.
</pre>
<img vspace="5" hspace="5" src="untitled2_01.png" alt=""> <h2 id="8">evaluation</h2>
<pre class="codeinput">predictedLabels = classify(net, augValDs);
actualLabels = imdsValidation.Labels;
accuracy = sum(predictedLabels == actualLabels) / numel(actualLabels);
fprintf(<span class="string">'Validation Accuracy: %.2f%%\n'</span>, accuracy * 100);
</pre>
<pre class="codeoutput">Validation Accuracy: 90.97%
</pre>
<h2 id="9">Saving the model</h2>
<pre class="codeinput">save(<span class="string">'mymodel.mat'</span>,<span class="string">'net'</span>)
</pre>
<p class="footer">
<br>
<a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2023b</a>
<br>
</p>
</div>
<!--
##### SOURCE BEGIN #####

%% loading dataset
folders = {'dataset1', 'dataset2', 'dataset3', 'dataset4'};
imds = imageDatastore(folders, "IncludeSubfolders", true, "LabelSource", "foldernames");
label_set = countEachLabel(imds);
img = readimage(imds,1);
disp(size(img));  % Just to check original size

%% shuffling data
imdsrand = shuffle(imds);

%% train-test split
[imdsTrain, imdsValidation] = splitEachLabel(imdsrand, 0.8, 'randomized');

%% data augmentation for training
augmenter = imageDataAugmenter( ...
    'RandRotation', [-10,10], ...
    'RandXTranslation', [-10 10], ...
    'RandYTranslation', [-10 10], ...
    'RandXScale', [0.9 1.1], ...
    'RandYScale', [0.9 1.1]);

augTrainDs = augmentedImageDatastore([83 226 3], imdsTrain, ...
    'DataAugmentation', augmenter, ...
    'ColorPreprocessing', 'gray2rgb');

augValDs = augmentedImageDatastore([83 226 3], imdsValidation, ...
    'ColorPreprocessing', 'gray2rgb');

%% network structure (with 4 conv layers + flattening)
layers = [
    imageInputLayer([83 226 3])

    convolution2dLayer(3, 16, 'Padding', 'same')
    batchNormalizationLayer
    reluLayer
    maxPooling2dLayer(2, 'Stride', 2)

    convolution2dLayer(3, 32, 'Padding', 'same')
    batchNormalizationLayer
    reluLayer
    maxPooling2dLayer(2, 'Stride', 2)

    convolution2dLayer(3, 64, 'Padding', 'same')
    batchNormalizationLayer
    reluLayer
    maxPooling2dLayer(2, 'Stride', 2)

    convolution2dLayer(3, 128, 'Padding', 'same')
    batchNormalizationLayer
    reluLayer
    maxPooling2dLayer(2, 'Stride', 2)

    flattenLayer

    fullyConnectedLayer(2)  % Binary classification
    softmaxLayer
    classificationLayer
];

%% training options
options = trainingOptions('adam', ...
    'MaxEpochs', 15, ...
    'MiniBatchSize', 16, ...
    'Shuffle', 'every-epoch', ...
    'ValidationData', augValDs, ...
    'ValidationFrequency', 20, ...
    'Verbose', true, ...
    'Plots', 'training-progress');

%% training
net = trainNetwork(augTrainDs, layers, options);

%% evaluation
predictedLabels = classify(net, augValDs);
actualLabels = imdsValidation.Labels;
accuracy = sum(predictedLabels == actualLabels) / numel(actualLabels);
fprintf('Validation Accuracy: %.2f%%\n', accuracy * 100);
%% Saving the model

save('mymodel.mat','net')

##### SOURCE END #####
-->
</body>
</html>
